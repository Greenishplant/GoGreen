<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Greenish Plant - Premium Store</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background: #eaf4f0; color: #1b4332; overflow-x: hidden; }
        
        #canvas-container { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; z-index: -1; pointer-events: none; }
        
        /* Glassmorphism UI */
        .glass-box { background: rgba(255, 255, 255, 0.95); padding: 30px; border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); width: 100%; max-width: 450px; text-align: center; }
        .overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: rgba(0,0,0,0.7); backdrop-filter: blur(5px); display: flex; justify-content: center; align-items: center; z-index: 2000; padding: 15px; }
        
        input, textarea, select { width: 100%; padding: 15px; margin: 10px 0; border: 1px solid #ccc; border-radius: 10px; outline: none; font-size: 14px; }
        .btn-primary { padding: 12px; background: #2d6a4f; color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; width: 100%; transition: 0.3s; font-size: 15px; }
        .btn-primary:hover { background: #1b4332; transform: translateY(-2px); }
        
        header { display: flex; justify-content: space-between; align-items: center; padding: 15px 5%; background: rgba(255,255,255,0.9); box-shadow: 0 2px 10px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 1000; backdrop-filter: blur(10px); }
        .logo { font-size: 24px; font-weight: 800; color: #2d6a4f; }
        nav { display: flex; gap: 20px; align-items: center; }
        nav a { font-weight: 600; cursor: pointer; text-decoration: none; color: #1b4332; }
        
        .page-section { min-height: 80vh; padding: 40px 5%; display: none; }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; margin-top: 20px; }
        .card { background: white; padding: 15px; border-radius: 15px; text-align: center; border: 1px solid #eee; transition: 0.3s; opacity: 0; transform: translateY(30px); }
        .card:hover { box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
        .card img { width: 100%; height: 180px; object-fit: cover; border-radius: 10px; margin-bottom: 10px; }
        
        .admin-table { width: 100%; background: white; border-collapse: collapse; margin-top: 10px; border-radius: 10px; overflow: hidden; font-size: 14px; }
        .admin-table th, .admin-table td { padding: 15px; border-bottom: 1px solid #eee; text-align: left; }
        
        /* TRACKING BAR UI */
        .track-bar { display: flex; justify-content: space-between; margin-top: 10px; position: relative; }
        .track-bar::before { content: ''; position: absolute; top: 12px; left: 10%; width: 80%; height: 4px; background: #eee; z-index: 0; }
        .track-step { position: relative; z-index: 1; text-align: center; font-size: 10px; font-weight: bold; color: gray; width: 33%; }
        .track-step .icon { width: 28px; height: 28px; background: #eee; border-radius: 50%; margin: 0 auto 5px; display: flex; justify-content: center; align-items: center; font-size: 12px; }
        .track-step.active .icon { background: #2d6a4f; color: white; }
        .track-step.active { color: #2d6a4f; }

        /* HYPER-REALISTIC RAZORPAY CLONE */
        .rzp-overlay { position: fixed; top:0; left:0; width:100vw; height:100vh; background: rgba(0,0,0,0.7); z-index: 6000; display: none; justify-content: center; align-items: center; }
        .rzp-box { background: white; width: 380px; border-radius: 8px; overflow: hidden; box-shadow: 0 10px 50px rgba(0,0,0,0.3); font-family: -apple-system, sans-serif; }
        .rzp-header { background: #0c182c; color: white; padding: 25px 20px 15px; position: relative; }
        .rzp-test-mode { position: absolute; top: 10px; right: 10px; background: rgba(255,255,255,0.2); font-size: 10px; padding: 3px 6px; border-radius: 3px; font-weight: bold; }
        .rzp-contact { background: rgba(255,255,255,0.1); padding: 8px 12px; border-radius: 5px; font-size: 13px; margin-top: 15px; display: flex; justify-content: space-between; }
        .rzp-body { padding: 20px; }
        .rzp-option { border: 1px solid #ddd; padding: 15px; border-radius: 6px; display: flex; justify-content: space-between; align-items: center; cursor: pointer; margin-bottom: 12px; transition: 0.2s; }
        .rzp-option:hover { border-color: #338cf8; background: #f5f9ff; }
        .rzp-btn { background: #338cf8; color: white; width: 100%; padding: 15px; border: none; font-size: 16px; font-weight: bold; cursor: pointer; border-radius: 5px; margin-top: 10px; }
        
        .otp-screen { display: none; padding: 20px; text-align: center; }
        .otp-screen input { width: 60%; letter-spacing: 5px; font-size: 20px; text-align: center; font-weight: bold; }

        @media (max-width: 768px) { header { flex-direction: column; gap: 10px; } .product-grid { grid-template-columns: repeat(2, 1fr); gap: 10px; } }
    </style>
</head>
<body>

    <div id="canvas-container"></div>

    <div id="loginScreen" class="overlay" style="display:flex;">
        <div class="glass-box" id="loginBox">
            <h2 style="color:#2d6a4f; font-size: 28px; margin-bottom: 5px;">üåø Greenish</h2>
            <p style="color: #666; margin-bottom: 20px; font-size: 14px;">Log in to access your saved orders</p>
            
            <input type="number" id="mobile" placeholder="Enter 10-Digit Mobile No.">
            <button class="btn-primary" onclick="loginUser()">Secure Login</button>
            
            <p onclick="adminLogin()" style="margin-top: 20px; font-size: 12px; color: #2d6a4f; cursor: pointer; font-weight: bold; text-decoration: underline;">Admin Portal</p>
        </div>
    </div>

    <header id="navBar" style="display: none;">
        <div class="logo">üåø Greenish</div>
        <nav>
            <a onclick="showPage('shopPage')">Shop</a>
            <a onclick="showPage('orderPage')">üì¶ My Orders</a>
            <a onclick="openCart()" style="background:#2d6a4f; color:white; padding:5px 15px; border-radius:20px;">
                <i class="fa-solid fa-cart-shopping"></i> Cart (<span id="cartCount">0</span>)
            </a>
            <a onclick="logoutUser()" style="color: red; cursor: pointer;"><i class="fa-solid fa-power-off"></i></a>
        </nav>
    </header>

    <div id="mainApp" style="display: none;">
        <section id="shopPage" class="page-section" style="display: block;">
            <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:10px;">
                <h2>Welcome, <span id="userDisplayPhone" style="color:#2d6a4f;"></span>!</h2>
                <input type="text" id="searchBar" placeholder="Search plants..." style="width:200px; padding:10px; margin:0;" onkeyup="searchPlants()">
            </div>
            <div class="product-grid" id="plantsGrid"></div>
        </section>

        <section id="orderPage" class="page-section">
            <h2>üì¶ My Order Tracking</h2>
            <p style="font-size: 12px; color: gray;">Orders linked to your mobile number.</p>
            <div id="ordersList" style="margin-top:20px;"></div>
        </section>

        <section id="adminPage" class="page-section">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom: 20px;">
                <h2>‚öôÔ∏è Logistics Control Center</h2>
                <button class="btn-primary" style="width:auto; padding:8px 15px;" onclick="fetchLiveOrders()"><i class="fa-solid fa-rotate-right"></i> Sync DB</button>
            </div>

            <div style="overflow-x:auto;">
                <table class="admin-table">
                    <thead style="background:#2d6a4f; color:white;">
                        <tr><th>Order ID</th><th>Customer Phone</th><th>Address</th><th>Amount</th><th>Update Status</th></tr>
                    </thead>
                    <tbody id="adminTableBody"></tbody>
                </table>
            </div>
        </section>
    </div>

    <div id="cartModal" class="overlay" style="display:none;">
        <div class="glass-box" id="cartBox" style="position:relative; text-align:left;">
            <i class="fa-solid fa-xmark" style="position:absolute; top:20px; right:20px; cursor:pointer; font-size:20px; color:red;" onclick="closeModal('cartModal')"></i>
            <h2 style="margin-bottom: 15px;">Your Cart üõí</h2>
            <div id="cartItems" style="max-height: 200px; overflow-y: auto; margin-bottom: 15px;"></div>
            <div style="text-align: right; border-top: 1px solid #ccc; padding-top:10px;">
                <h3 style="color: #2d6a4f;">Total: ‚Çπ<span id="totalPrice">0</span></h3>
            </div>
            <button class="btn-primary" style="margin-top: 15px; background: #ff9f00;" onclick="openAddressForm()">Checkout</button>
        </div>
    </div>

    <div id="checkoutModal" class="overlay" style="display:none;">
        <div class="glass-box" style="position:relative; text-align:left;">
            <i class="fa-solid fa-xmark" style="position:absolute; top:20px; right:20px; cursor:pointer; font-size:20px; color:red;" onclick="closeModal('checkoutModal')"></i>
            <h2>Delivery Details</h2>
            <textarea id="userAddress" placeholder="Full Delivery Address (House No, Street, City)" rows="3"></textarea>
            <button class="btn-primary" onclick="initRazorpay()">Proceed to Pay Gateway</button>
        </div>
    </div>

    <div id="razorpayOverlay" class="rzp-overlay">
        <div class="rzp-box" id="rzpBox">
            
            <div id="rzpMainScreen">
                <div class="rzp-header">
                    <span class="rzp-test-mode">TEST MODE</span>
                    <div style="font-size: 14px; opacity: 0.8; margin-bottom: 5px;">Greenish Enterprises</div>
                    <div style="font-size: 28px; font-weight: bold;">‚Çπ<span id="rzpAmount">0.00</span></div>
                    <div class="rzp-contact">
                        <span><i class="fa-solid fa-phone"></i> +91 <span id="rzpPhone"></span></span>
                        <span style="color: #64b5f6; cursor: pointer;">Edit</span>
                    </div>
                </div>
                <div class="rzp-body">
                    <p style="font-size: 12px; color: gray; margin-bottom: 10px;">CARDS, UPI & MORE</p>
                    
                    <div class="rzp-option" onclick="showBankOTP()">
                        <div><i class="fa-brands fa-google-pay" style="color:#1a73e8; font-size:20px;"></i> <span style="margin-left:10px; font-weight:bold;">Pay via UPI / QR</span></div>
                        <i class="fa-solid fa-chevron-right" style="color:#ccc;"></i>
                    </div>
                    
                    <div class="rzp-option" onclick="showBankOTP()">
                        <div><i class="fa-regular fa-credit-card" style="color:#333; font-size:18px;"></i> <span style="margin-left:10px; font-weight:bold;">Credit / Debit Card</span></div>
                        <i class="fa-solid fa-chevron-right" style="color:#ccc;"></i>
                    </div>

                    <p style="text-align: center; margin-top: 15px; font-size: 10px; color: gray;"><i class="fa-solid fa-lock"></i> Secured by Razorpay</p>
                </div>
            </div>

            <div id="rzpOTPScreen" class="otp-screen" style="background: #f9f9f9; height: 100%;">
                <img src="https://upload.wikimedia.org/wikipedia/commons/thumb/c/cc/SBI-logo.svg/1024px-SBI-logo.svg.png" style="width: 50px; margin-bottom: 15px;">
                <h3 style="color: #333;">Authentication Required</h3>
                <p style="font-size: 12px; color: gray; margin-bottom: 20px;">An OTP has been sent to your mobile <span id="otpPhone"></span></p>
                
                <input type="number" placeholder="‚Ä¢ ‚Ä¢ ‚Ä¢ ‚Ä¢ ‚Ä¢ ‚Ä¢" id="fakeOTP">
                
                <button class="rzp-btn" style="background: #2874f0;" onclick="submitFakeOTP()" id="otpBtn">Verify & Pay</button>
                <p style="font-size: 11px; color: #1a73e8; margin-top: 15px; cursor: pointer;">Resend OTP</p>
            </div>

            <div id="rzpSuccessState" style="display:none; text-align:center; padding: 60px 20px;">
                <i class="fa-solid fa-circle-check" style="font-size: 50px; color: #1ba672; margin-bottom: 15px;"></i>
                <h2 style="color: #1ba672;">Payment Successful</h2>
                <p style="font-size: 12px; color: gray; margin-top: 5px;">Redirecting back to Greenish...</p>
            </div>
        </div>
    </div>

    <div id="finalSuccessModal" class="overlay" style="display:none;">
        <div class="glass-box" id="successBox" style="text-align:center; padding: 40px 20px;">
            <i class="fa-solid fa-circle-check" style="font-size: 50px; color: #2d6a4f; margin-bottom: 15px;"></i>
            <h2>Order Confirmed!</h2>
            <p style="margin: 10px 0;">Order ID: <b id="finalOrderId"></b></p>
            <p style="font-size: 12px; color: gray;">Your data is saved to our Enterprise Server.</p>
            <button class="btn-primary" style="margin-top: 15px;" onclick="finishShopping()">Track My Order</button>
        </div>
    </div>

    <script>
        const inventory = [
            { id: 1, name: "Monstera Deliciosa", price: 499, img: "https://images.pexels.com/photos/3125195/pexels-photo-3125195.jpeg?w=400" },
            { id: 2, name: "Snake Plant", price: 299, img: "https://images.pexels.com/photos/2123482/pexels-photo-2123482.jpeg?w=400" },
            { id: 3, name: "Ficus Bonsai", price: 899, img: "https://images.pexels.com/photos/3273934/pexels-photo-3273934.jpeg?w=400" },
            { id: 4, name: "Aloe Vera", price: 199, img: "https://images.pexels.com/photos/1334605/pexels-photo-1334605.jpeg?w=400" },
            { id: 5, name: "Red Rose Plant", price: 349, img: "https://images.pexels.com/photos/736230/pexels-photo-736230.jpeg?w=400" },
            { id: 6, name: "Peace Lily", price: 450, img: "https://images.pexels.com/photos/1105019/pexels-photo-1105019.jpeg?w=400" },
            { id: 7, name: "Areca Palm", price: 699, img: "https://images.pexels.com/photos/1084199/pexels-photo-1084199.jpeg?w=400" },
            { id: 8, name: "Spider Plant", price: 150, img: "https://images.pexels.com/photos/3125195/pexels-photo-3125195.jpeg?w=400" },
            { id: 9, name: "Rubber Plant", price: 550, img: "https://images.pexels.com/photos/2123482/pexels-photo-2123482.jpeg?w=400" },
            { id: 10, name: "Bamboo Plant", price: 299, img: "https://images.pexels.com/photos/3273934/pexels-photo-3273934.jpeg?w=400" },
            { id: 11, name: "Jade Plant", price: 250, img: "https://images.pexels.com/photos/1334605/pexels-photo-1334605.jpeg?w=400" },
            { id: 12, name: "Ceramic Pot", price: 399, img: "https://images.pexels.com/photos/6601444/pexels-photo-6601444.jpeg?w=400" }
        ];

        let cartData = [];
        let activeUserPhone = "";

        // Checking if user is already logged in (Persistent Session)
        window.onload = () => {
            init3D();
            let savedUser = localStorage.getItem("greenish_user");
            if(savedUser) {
                activeUserPhone = savedUser;
                document.getElementById("loginScreen").style.display = "none";
                document.getElementById("navBar").style.display = "flex";
                document.getElementById("mainApp").style.display = "block";
                document.getElementById("userDisplayPhone").innerText = activeUserPhone;
                renderShop();
            } else {
                gsap.from("#loginBox", {scale: 0.8, opacity: 0, duration: 0.6, ease: "back.out(1.7)"});
            }
        };

        function loginUser() {
            let mobile = document.getElementById("mobile").value;
            if(mobile.length === 10) {
                activeUserPhone = mobile;
                localStorage.setItem("greenish_user", activeUserPhone); // Save identity
                document.getElementById("userDisplayPhone").innerText = activeUserPhone;
                
                gsap.to("#loginScreen", { opacity: 0, duration: 0.3, onComplete: () => {
                    document.getElementById("loginScreen").style.display = "none";
                    document.getElementById("navBar").style.display = "flex";
                    document.getElementById("mainApp").style.display = "block";
                    renderShop();
                }});
            } else { alert("Enter 10-digit number!"); }
        }

        function logoutUser() {
            localStorage.removeItem("greenish_user");
            location.reload();
        }

        function adminLogin() {
            if(prompt("Admin ID:") === "Vivek02" && prompt("Password:") === "Vivek1234@") {
                document.getElementById("loginScreen").style.display = "none";
                document.getElementById("navBar").style.display = "flex";
                document.getElementById("mainApp").style.display = "block";
                showPage('adminPage');
            } else { alert("Incorrect Credentials!"); }
        }

        function showPage(pageId) {
            document.querySelectorAll('.page-section').forEach(page => page.style.display = 'none');
            document.getElementById(pageId).style.display = 'block';
            if(pageId === 'shopPage') renderShop();
            if(pageId === 'orderPage') renderMyOrders();
            if(pageId === 'adminPage') fetchLiveOrders();
            window.scrollTo(0, 0);
        }

        function renderShop() {
            const grid = document.getElementById("plantsGrid"); grid.innerHTML = "";
            let query = document.getElementById("searchBar").value.toLowerCase();
            inventory.forEach(plant => {
                if(plant.name.toLowerCase().includes(query)) {
                    grid.innerHTML += `
                        <div class="card">
                            <img src="${plant.img}">
                            <h3 style="font-size:16px;">${plant.name}</h3>
                            <p style="font-size:18px; font-weight:bold; color:#2d6a4f; margin:10px 0;">‚Çπ${plant.price}</p>
                            <button class="btn-primary" onclick="addToCart(${plant.id})">Add to Cart</button>
                        </div>`;
                }
            });
            gsap.to(".card", {opacity: 1, y: 0, duration: 0.5, stagger: 0.05, ease: "power2.out"});
        }
        function searchPlants() { renderShop(); }

        function addToCart(id) {
            cartData.push(inventory.find(p => p.id === id));
            document.getElementById("cartCount").innerText = cartData.length;
            gsap.fromTo("#cartCount", {scale: 1.5}, {scale: 1, duration: 0.3});
        }

        function openCart() {
            document.getElementById("cartModal").style.display = "flex";
            let list = document.getElementById("cartItems"); list.innerHTML = ""; let total = 0;
            if(cartData.length === 0) list.innerHTML = "<p style='color:gray;'>Cart is empty.</p>";
            cartData.forEach((item, index) => {
                total += item.price;
                list.innerHTML += `<div style="display:flex; justify-content:space-between; border-bottom:1px solid #eee; padding:8px 0;">
                    <span>${item.name}</span><span>‚Çπ${item.price} <i class="fa-solid fa-trash" style="color:red; cursor:pointer;" onclick="cartData.splice(${index}, 1); openCart();"></i></span></div>`;
            });
            document.getElementById("totalPrice").innerText = total;
        }

        function closeModal(modalId) { document.getElementById(modalId).style.display = "none"; }
        function openAddressForm() {
            if(cartData.length === 0) return alert("Cart empty!");
            closeModal('cartModal'); document.getElementById("checkoutModal").style.display = "flex";
        }

        // üî• THE RAZORPAY CLONE LOGIC
        function initRazorpay() {
            let address = document.getElementById("userAddress").value;
            if(address.trim() === "") return alert("Please enter delivery address!");
            
            closeModal('checkoutModal');
            document.getElementById("rzpAmount").innerText = document.getElementById("totalPrice").innerText + ".00";
            document.getElementById("rzpPhone").innerText = activeUserPhone;
            document.getElementById("otpPhone").innerText = "+91 " + activeUserPhone;
            
            // Reset screens
            document.getElementById("rzpMainScreen").style.display = "block";
            document.getElementById("rzpOTPScreen").style.display = "none";
            document.getElementById("rzpSuccessState").style.display = "none";
            
            document.getElementById("razorpayOverlay").style.display = "flex";
            gsap.fromTo("#rzpBox", {y: 100, opacity: 0}, {y: 0, opacity: 1, duration: 0.4});
        }

        function showBankOTP() {
            document.getElementById("rzpMainScreen").style.display = "none";
            document.getElementById("rzpOTPScreen").style.display = "block";
        }

        function submitFakeOTP() {
            let otp = document.getElementById("fakeOTP").value;
            if(otp === "") return alert("Enter any fake 6-digit OTP!");
            
            document.getElementById("otpBtn").innerText = "Verifying...";
            
            setTimeout(() => {
                document.getElementById("rzpOTPScreen").style.display = "none";
                document.getElementById("rzpSuccessState").style.display = "block";
                
                // After success, send to Java Database
                sendDataToJavaBackend();
            }, 1500);
        }

        async function sendDataToJavaBackend() {
            let address = document.getElementById("userAddress").value;
            // Notice: We add 'phone' here to link the order to the user!
            let newOrder = { 
                id: "ORD" + Math.floor(Math.random() * 9999), 
                phone: activeUserPhone, 
                total: document.getElementById("totalPrice").innerText, 
                address: address, 
                date: new Date().toLocaleDateString(), 
                items: [...cartData] 
            };

            try {
                await fetch('/api/commitTransaction', { method: 'POST', headers: {'Content-Type': 'application/json'}, body: JSON.stringify(newOrder) });
                // Fallback local storage for immediate view
                let localOrders = JSON.parse(localStorage.getItem('saved_orders')) || []; localOrders.push(newOrder); localStorage.setItem('saved_orders', JSON.stringify(localOrders));
                showFinalSuccess(newOrder.id);
            } catch(error) { showFinalSuccess(newOrder.id); }
        }

        function showFinalSuccess(orderId) {
            setTimeout(() => {
                document.getElementById("razorpayOverlay").style.display = "none";
                document.getElementById("finalSuccessModal").style.display = "flex";
                document.getElementById("finalOrderId").innerText = orderId;
                confetti({ particleCount: 150, spread: 80, zIndex: 6000 });
                cartData = []; document.getElementById("cartCount").innerText = "0";
            }, 1000);
        }

        function finishShopping() { closeModal('finalSuccessModal'); showPage('orderPage'); }

        // üì¶ REAL-TIME TRACKING FOR USER
        async function renderMyOrders() {
            let container = document.getElementById("ordersList"); container.innerHTML = "";
            let orders = [];
            
            try {
                // Try fetching from Java
                const res = await fetch('/api/fetchOrders'); 
                orders = await res.json();
            } catch(e) {
                // Fallback to local
                orders = JSON.parse(localStorage.getItem('saved_orders')) || [];
            }

            // FILTER ORDERS BY CURRENT LOGGED IN PHONE NUMBER!
            let myOrders = orders.filter(o => o.phone === activeUserPhone);
            
            if(myOrders.length === 0) {
                container.innerHTML = "<div style='background:white; padding:20px; border-radius:10px; text-align:center;'><p>No orders found for your number.</p></div>";
                return;
            }

            // Get Status DB from Admin
            let trackingStatusDB = JSON.parse(localStorage.getItem("tracking_db")) || {};
            
            myOrders.reverse().forEach(order => {
                let status = trackingStatusDB[order.id] || "Processing";
                
                let s1 = "active"; let s2 = (status === "Shipped" || status === "Delivered") ? "active" : ""; let s3 = (status === "Delivered") ? "active" : "";

                container.innerHTML += `
                    <div style="background: white; padding: 20px; border-radius: 15px; margin-bottom: 20px; border: 1px solid #eee;">
                        <div style="display:flex; justify-content:space-between; margin-bottom: 10px;">
                            <b>#${order.id}</b>
                            <b style="color:#2d6a4f;">‚Çπ${order.total}</b>
                        </div>
                        <p style="font-size:12px; color:gray; margin-bottom: 15px;">Date: ${order.date}</p>
                        
                        <div class="track-bar">
                            <div class="track-step ${s1}"><div class="icon"><i class="fa-solid fa-box"></i></div>Processing</div>
                            <div class="track-step ${s2}"><div class="icon"><i class="fa-solid fa-truck"></i></div>Shipped</div>
                            <div class="track-step ${s3}"><div class="icon"><i class="fa-solid fa-check"></i></div>Delivered</div>
                        </div>
                    </div>
                `;
            });
        }

        // ‚öôÔ∏è ADMIN STATUS CONTROLLER
        async function fetchLiveOrders() {
            try {
                const response = await fetch('/api/fetchOrders'); const orders = await response.json();
                let tbody = document.getElementById("adminTableBody"); tbody.innerHTML = "";
                
                let trackingStatusDB = JSON.parse(localStorage.getItem("tracking_db")) || {};

                orders.reverse().forEach(order => {
                    let currentStatus = trackingStatusDB[order.id] || "Processing";
                    tbody.innerHTML += `
                        <tr>
                            <td><b>#${order.id}</b></td>
                            <td>${order.phone || "N/A"}</td>
                            <td style="font-size:12px;">${order.address}</td>
                            <td style='color:#2d6a4f; font-weight:bold;'>‚Çπ${order.total}</td>
                            <td>
                                <select onchange="updateStatus('${order.id}', this.value)" style="padding: 5px; width: 130px; border-radius: 5px; background: #f9f9f9;">
                                    <option value="Processing" ${currentStatus==='Processing'?'selected':''}>‚è≥ Processing</option>
                                    <option value="Shipped" ${currentStatus==='Shipped'?'selected':''}>üöö Shipped</option>
                                    <option value="Delivered" ${currentStatus==='Delivered'?'selected':''}>‚úÖ Delivered</option>
                                </select>
                            </td>
                        </tr>`;
                });
            } catch(e) { document.getElementById("adminTableBody").innerHTML = "<tr><td colspan='5'>Server Refreshing...</td></tr>"; }
        }

        function updateStatus(orderId, newStatus) {
            let trackingStatusDB = JSON.parse(localStorage.getItem("tracking_db")) || {};
            trackingStatusDB[orderId] = newStatus;
            localStorage.setItem("tracking_db", JSON.stringify(trackingStatusDB));
            alert("Order " + orderId + " updated to " + newStatus);
        }

        // 3D Background
        function init3D() {
            const scene = new THREE.Scene(); const camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true }); renderer.setSize(window.innerWidth, window.innerHeight);
            document.getElementById('canvas-container').appendChild(renderer.domElement);
            const shape = new THREE.Mesh(new THREE.TorusKnotGeometry(1.5, 0.4, 100, 16), new THREE.MeshStandardMaterial({ color: 0x40916c, wireframe: true }));
            scene.add(shape); const light = new THREE.PointLight(0xffffff, 1); light.position.set(10, 10, 10); scene.add(light); camera.position.z = 6;
            function animate() { requestAnimationFrame(animate); shape.rotation.x += 0.005; shape.rotation.y += 0.005; renderer.render(scene, camera); } animate();
        }
    </script>
</body>
</html>

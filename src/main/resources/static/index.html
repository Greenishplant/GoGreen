<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Greenish Plant - Premium Store</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;600;700&display=swap');
        
        * { margin: 0; padding: 0; box-sizing: border-box; font-family: 'Poppins', sans-serif; }
        body { background: #eaf4f0; color: #1b4332; overflow-x: hidden; }
        
        /* Glassmorphism UI */
        .glass-box { background: rgba(255, 255, 255, 0.95); padding: 30px; border-radius: 20px; box-shadow: 0 15px 35px rgba(0,0,0,0.1); width: 100%; max-width: 400px; text-align: center; }
        .overlay { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: #1b4332; display: flex; justify-content: center; align-items: center; z-index: 2000; padding: 15px; }
        
        input, textarea { width: 100%; padding: 15px; margin: 15px 0; border: 1px solid #ccc; border-radius: 10px; outline: none; font-size: 14px; }
        .btn-primary { padding: 15px; background: #2d6a4f; color: white; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; width: 100%; transition: 0.3s; font-size: 16px; }
        .btn-primary:hover { background: #1b4332; transform: translateY(-2px); }
        
        /* Header & Navigation */
        header { display: flex; justify-content: space-between; align-items: center; padding: 20px 5%; background: white; box-shadow: 0 2px 10px rgba(0,0,0,0.05); position: sticky; top: 0; z-index: 1000; }
        .logo { font-size: 24px; font-weight: 800; color: #2d6a4f; }
        nav { display: flex; gap: 20px; align-items: center; }
        nav a { font-weight: 600; cursor: pointer; text-decoration: none; color: #1b4332; }
        
        /* Grid Layout */
        .page-section { min-height: 80vh; padding: 40px 5%; display: none; }
        .product-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(220px, 1fr)); gap: 20px; margin-top: 20px; }
        .card { background: white; padding: 15px; border-radius: 15px; text-align: center; border: 1px solid #eee; transition: 0.3s; }
        .card:hover { transform: translateY(-5px); box-shadow: 0 10px 20px rgba(0,0,0,0.05); }
        .card img { width: 100%; height: 180px; object-fit: cover; border-radius: 10px; margin-bottom: 10px; }
        
        /* Modals */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: none; justify-content: center; align-items: center; z-index: 5000; padding: 20px; }
        
        @media (max-width: 768px) {
            header { flex-direction: column; gap: 15px; }
            .product-grid { grid-template-columns: repeat(2, 1fr); gap: 10px; }
        }
    </style>
</head>
<body>

    <div id="loginScreen" class="overlay">
        <div class="glass-box">
            <h2 style="color:#2d6a4f; font-size: 28px; margin-bottom: 5px;">üåø Greenish</h2>
            <p style="color: #666; margin-bottom: 20px; font-size: 14px;">Welcome to Premium Plant Store</p>
            
            <input type="number" id="mobile" placeholder="Enter 10-Digit Mobile No.">
            
            <button class="btn-primary" onclick="loginUser()">Secure Login</button>
            
            <p onclick="adminLogin()" style="margin-top: 20px; font-size: 12px; color: #2d6a4f; cursor: pointer; font-weight: bold; text-decoration: underline;">Admin / Owner Access</p>
        </div>
    </div>

    <header id="navBar" style="display: none;">
        <div class="logo">üåø Greenish</div>
        <nav>
            <a onclick="showPage('shopPage')">Shop</a>
            <a onclick="showPage('orderPage')">üì¶ Orders</a>
            <a onclick="openCart()" style="background:#2d6a4f; color:white; padding:8px 15px; border-radius:20px;">
                <i class="fa-solid fa-cart-shopping"></i> Cart (<span id="cartCount">0</span>)
            </a>
            <a onclick="location.reload()" style="color: red;"><i class="fa-solid fa-power-off"></i></a>
        </nav>
    </header>

    <div id="mainApp" style="display: none;">
        
        <section id="shopPage" class="page-section" style="display: block;">
            <div style="display:flex; justify-content:space-between; align-items:center; flex-wrap:wrap; gap:10px;">
                <h2 style="font-size: 24px;">Explore Plants</h2>
                <input type="text" id="searchBar" placeholder="Search..." style="width:200px; padding:10px; margin:0;" onkeyup="searchPlants()">
            </div>
            <div class="product-grid" id="plantsGrid"></div>
        </section>

        <section id="orderPage" class="page-section">
            <h2>üì¶ My Recent Orders</h2>
            <div id="ordersList" style="margin-top:20px;"></div>
        </section>

        <section id="adminPage" class="page-section">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:20px;">
                <h2>‚öôÔ∏è Admin Control Panel</h2>
                <button class="btn-primary" style="width:auto; padding:10px 20px;" onclick="fetchLiveOrders()">Refresh Database</button>
            </div>
            <div style="background:white; padding:20px; border-radius:15px; overflow-x:auto;">
                <table width="100%" style="border-collapse: collapse; text-align:left;">
                    <thead>
                        <tr style="background:#2d6a4f; color:white;">
                            <th style="padding:15px;">Order ID</th>
                            <th style="padding:15px;">Address</th>
                            <th style="padding:15px;">Amount</th>
                            <th style="padding:15px;">Status</th>
                        </tr>
                    </thead>
                    <tbody id="adminTableBody"></tbody>
                </table>
            </div>
        </section>

    </div>

    <div id="cartModal" class="modal-overlay">
        <div class="glass-box" style="position:relative; text-align:left; max-width: 500px;">
            <i class="fa-solid fa-xmark" style="position:absolute; top:20px; right:20px; cursor:pointer; font-size:20px; color:red;" onclick="closeModal('cartModal')"></i>
            <h2 style="margin-bottom: 20px;">Your Cart üõí</h2>
            
            <div id="cartItems" style="max-height: 250px; overflow-y: auto; margin-bottom: 20px;"></div>
            
            <div style="border-top: 2px dashed #ccc; padding-top: 15px; text-align: right;">
                <p style="color: gray; font-size: 14px; margin-bottom: 5px;">Delivery: <span style="color:green; font-weight:bold;">FREE</span></p>
                <h3 style="color: #2d6a4f; font-size: 22px;">Total: ‚Çπ<span id="totalPrice">0</span></h3>
            </div>
            
            <button class="btn-primary" style="margin-top: 20px; background: #ff9f00;" onclick="startCheckout()">Proceed to Buy</button>
        </div>
    </div>

    <div id="checkoutModal" class="modal-overlay">
        <div class="glass-box" style="position:relative; text-align:left;">
            <i class="fa-solid fa-xmark" style="position:absolute; top:20px; right:20px; cursor:pointer; font-size:20px; color:red;" onclick="closeModal('checkoutModal')"></i>
            
            <div id="checkoutForm">
                <h2 style="margin-bottom: 15px;">Secure Checkout</h2>
                <label style="font-size: 14px; font-weight: bold;">Delivery Address:</label>
                <textarea id="userAddress" placeholder="House No, Area, City, Pincode" rows="3"></textarea>
                
                <div style="background: #f1f3f6; padding: 15px; border-radius: 10px; text-align: center; margin-bottom: 15px;">
                    <p style="font-size: 12px; margin-bottom: 10px;">Pay via UPI (Scan QR)</p>
                    <img src="https://api.qrserver.com/v1/create-qr-code/?size=120x120&data=upi://pay?pa=vivek@upi" style="width: 120px; border-radius: 10px;">
                </div>
                
                <button class="btn-primary" onclick="placeOrder()">Pay & Confirm Order</button>
            </div>

            <div id="checkoutLoader" style="display:none; text-align:center; padding: 30px 0;">
                <i class="fa-solid fa-circle-notch fa-spin" style="font-size: 40px; color: #2d6a4f; margin-bottom: 15px;"></i>
                <h3>Processing Payment...</h3>
                <p style="font-size: 12px; color: gray;">Connecting to Java Server</p>
            </div>

            <div id="checkoutSuccess" style="display:none; text-align:center; padding: 20px 0;">
                <i class="fa-solid fa-circle-check" style="font-size: 50px; color: #2d6a4f; margin-bottom: 15px;"></i>
                <h2 style="color: #2d6a4f;">Order Placed!</h2>
                <p style="margin: 10px 0;">Order ID: <b id="finalOrderId"></b></p>
                <button class="btn-primary" style="margin-top: 15px;" onclick="finishShopping()">Continue Shopping</button>
            </div>
        </div>
    </div>

    <script>
        // Inventory
        const inventory = [
            { id: 1, name: "Monstera Deliciosa", price: 499, img: "https://images.pexels.com/photos/3125195/pexels-photo-3125195.jpeg?w=400" },
            { id: 2, name: "Snake Plant (Air Purifier)", price: 299, img: "https://images.pexels.com/photos/2123482/pexels-photo-2123482.jpeg?w=400" },
            { id: 3, name: "Ficus Bonsai Tree", price: 899, img: "https://images.pexels.com/photos/3273934/pexels-photo-3273934.jpeg?w=400" },
            { id: 4, name: "Red Rose Plant", price: 349, img: "https://images.pexels.com/photos/736230/pexels-photo-736230.jpeg?w=400" },
            { id: 5, name: "Aloe Vera Medicinal", price: 199, img: "https://images.pexels.com/photos/1334605/pexels-photo-1334605.jpeg?w=400" },
            { id: 6, name: "Premium Ceramic Pot", price: 399, img: "https://images.pexels.com/photos/6601444/pexels-photo-6601444.jpeg?w=400" }
        ];

        let cartData = [];

        // üü¢ BUG FIXED: Perfect Login Function
        function loginUser() {
            let mobile = document.getElementById("mobile").value;
            if(mobile.length === 10) {
                // Alert removed completely for smooth experience
                gsap.to("#loginScreen", { opacity: 0, duration: 0.4, onComplete: () => {
                    document.getElementById("loginScreen").style.display = "none";
                    document.getElementById("navBar").style.display = "flex";
                    document.getElementById("mainApp").style.display = "block";
                    renderShop();
                }});
            } else {
                alert("Boss, please enter a valid 10-digit mobile number!");
            }
        }

        function adminLogin() {
            let id = prompt("Enter Admin User ID:");
            let pass = prompt("Enter Admin Password:");
            if(id === "Vivek02" && pass === "Vivek1234@") {
                document.getElementById("loginScreen").style.display = "none";
                document.getElementById("navBar").style.display = "flex";
                document.getElementById("mainApp").style.display = "block";
                showPage('adminPage');
            } else {
                alert("Incorrect Admin Credentials!");
            }
        }

        // Navigation
        function showPage(pageId) {
            document.querySelectorAll('.page-section').forEach(page => page.style.display = 'none');
            document.getElementById(pageId).style.display = 'block';
            if(pageId === 'shopPage') renderShop();
            if(pageId === 'orderPage') renderMyOrders();
            if(pageId === 'adminPage') fetchLiveOrders();
            window.scrollTo(0, 0);
        }

        // Shop Features
        function renderShop() {
            const grid = document.getElementById("plantsGrid");
            grid.innerHTML = "";
            let query = document.getElementById("searchBar").value.toLowerCase();
            
            inventory.forEach(plant => {
                if(plant.name.toLowerCase().includes(query)) {
                    grid.innerHTML += `
                        <div class="card">
                            <img src="${plant.img}">
                            <h3 style="font-size: 16px; margin-bottom: 5px;">${plant.name}</h3>
                            <p style="font-size: 18px; font-weight: bold; color: #2d6a4f; margin-bottom: 10px;">‚Çπ${plant.price}</p>
                            <button class="btn-primary" onclick="addToCart(${plant.id})">Add to Cart</button>
                        </div>
                    `;
                }
            });
        }
        function searchPlants() { renderShop(); }

        // Cart Features
        function addToCart(id) {
            let plant = inventory.find(p => p.id === id);
            cartData.push(plant);
            document.getElementById("cartCount").innerText = cartData.length;
            
            // Success animation effect
            confetti({ particleCount: 50, spread: 40, origin: { y: 0.8 } });
        }

        function openCart() {
            document.getElementById("cartModal").style.display = "flex";
            let list = document.getElementById("cartItems");
            list.innerHTML = "";
            let total = 0;
            
            if(cartData.length === 0) {
                list.innerHTML = "<p style='text-align:center; color:gray;'>Your cart is empty.</p>";
            } else {
                cartData.forEach((item, index) => {
                    total += item.price;
                    list.innerHTML += `
                        <div style="display:flex; justify-content:space-between; align-items:center; border-bottom:1px solid #eee; padding: 10px 0;">
                            <span style="font-size: 14px;"><b>${item.name}</b></span>
                            <span style="font-size: 14px; font-weight: bold;">‚Çπ${item.price} <i class="fa-solid fa-trash" style="color:red; cursor:pointer; margin-left: 10px;" onclick="removeFromCart(${index})"></i></span>
                        </div>
                    `;
                });
            }
            document.getElementById("totalPrice").innerText = total;
        }

        function removeFromCart(index) {
            cartData.splice(index, 1);
            document.getElementById("cartCount").innerText = cartData.length;
            openCart();
        }

        function closeModal(modalId) { document.getElementById(modalId).style.display = "none"; }

        function startCheckout() {
            if(cartData.length === 0) return alert("Please add items to cart first!");
            closeModal('cartModal');
            document.getElementById("checkoutModal").style.display = "flex";
            document.getElementById("checkoutForm").style.display = "block";
            document.getElementById("checkoutSuccess").style.display = "none";
        }

        // üü¢ JAVA BACKEND CONNECTION
        async function placeOrder() {
            let address = document.getElementById("userAddress").value;
            if(address.trim() === "") return alert("Boss, please enter delivery address!");

            document.getElementById("checkoutForm").style.display = "none";
            document.getElementById("checkoutLoader").style.display = "block";

            let newOrder = {
                id: "ORD" + Math.floor(Math.random() * 99999),
                total: document.getElementById("totalPrice").innerText,
                address: address,
                date: new Date().toLocaleDateString(),
                items: [...cartData]
            };

            try {
                // Call to your Java Spring Boot Server
                await fetch('/api/commitTransaction', {
                    method: 'POST',
                    headers: {'Content-Type': 'application/json'},
                    body: JSON.stringify(newOrder)
                });
                
                // Save Locally for immediate view in 'My Orders'
                let localOrders = JSON.parse(localStorage.getItem('saved_orders')) || [];
                localOrders.push(newOrder);
                localStorage.setItem('saved_orders', JSON.stringify(localOrders));

                setTimeout(() => {
                    document.getElementById("checkoutLoader").style.display = "none";
                    document.getElementById("checkoutSuccess").style.display = "block";
                    document.getElementById("finalOrderId").innerText = newOrder.id;
                    confetti({ particleCount: 200, spread: 100, zIndex: 6000 });
                    
                    // Clear Cart
                    cartData = [];
                    document.getElementById("cartCount").innerText = "0";
                }, 2000);

            } catch(error) {
                alert("Java Server is booting up! Please try again in 30 seconds.");
                location.reload();
            }
        }

        function finishShopping() {
            closeModal('checkoutModal');
            showPage('orderPage');
        }

        // Render My Orders
        function renderMyOrders() {
            let localOrders = JSON.parse(localStorage.getItem('saved_orders')) || [];
            let container = document.getElementById("ordersList");
            container.innerHTML = "";
            
            if(localOrders.length === 0) {
                container.innerHTML = "<p>You have not placed any orders yet.</p>";
                return;
            }

            let html = "<table width='100%' style='border-collapse: collapse; text-align: left; background: white; border-radius: 10px; overflow: hidden;'><tr style='background:#f1f3f6;'><th style='padding:15px; border-bottom:1px solid #ddd;'>Order ID</th><th style='padding:15px; border-bottom:1px solid #ddd;'>Amount</th><th style='padding:15px; border-bottom:1px solid #ddd;'>Date</th></tr>";
            
            localOrders.reverse().forEach(order => {
                html += `<tr>
                            <td style='padding:15px; border-bottom:1px solid #eee; font-weight:bold;'>#${order.id}</td>
                            <td style='padding:15px; border-bottom:1px solid #eee; color:#2d6a4f; font-weight:bold;'>‚Çπ${order.total}</td>
                            <td style='padding:15px; border-bottom:1px solid #eee;'>${order.date}</td>
                         </tr>`;
            });
            container.innerHTML = html + "</table>";
        }

        // ‚öôÔ∏è Admin API Fetch
        async function fetchLiveOrders() {
            try {
                const response = await fetch('/api/fetchOrders');
                const orders = await response.json();
                
                let tbody = document.getElementById("adminTableBody");
                tbody.innerHTML = "";
                
                if(orders.length === 0) {
                    tbody.innerHTML = "<tr><td colspan='4' style='padding:15px; text-align:center;'>No orders in Database yet.</td></tr>";
                    return;
                }

                orders.reverse().forEach(order => {
                    tbody.innerHTML += `
                        <tr style='border-bottom: 1px solid #eee;'>
                            <td style='padding:15px; font-weight:bold;'>#${order.id}</td>
                            <td style='padding:15px; font-size: 13px;'>${order.address}</td>
                            <td style='padding:15px; font-weight:bold; color:#2d6a4f;'>‚Çπ${order.total}</td>
        
